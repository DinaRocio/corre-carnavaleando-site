---
import site from "../../content/site.json";

const { title, description, items } = site.gallery;
---

<section
  id="gallery"
  class="w-full px-4 py-12 md:px-8 md:py-24 lg:py-28 bg-(--color-gallery-background)"
>
  <div class="container-max mx-auto">
    <!-- Header -->
    <div class="flex flex-col items-center gap-4 mb-8 md:mb-12">
      <h2 class="heading-2 text-(--color-text) text-center">
        {title.toUpperCase()}
      </h2>
      <p class="body-16 text-(--color-text) text-center max-w-2xl">
        {description}
      </p>
    </div>

    <!-- Staggered Fade-in Gallery with Navigation -->
    <div class="relative">
      <!-- Gallery Container -->
      <div
        id="gallery-scroll"
        class="flex gap-3 md:gap-4 overflow-x-auto scroll-smooth scrollbar-hide pb-4"
      >
        {
          items.map((item, index) => (
            <div
              class="gallery-item opacity-0 translate-y-8 shrink-0 w-[280px] md:w-[320px] lg:w-[360px] overflow-hidden rounded-lg group"
              style={`--delay: ${index * 100}ms`}
            >
              <div class="relative aspect-[4/5]">
                <img
                  src={item.src}
                  alt={item.alt}
                  loading={index < 3 ? "eager" : "lazy"}
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                />
                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors duration-300" />
                <div class="absolute inset-0 flex items-end p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  <p class="text-white text-sm font-medium drop-shadow-lg">
                    {item.alt}
                  </p>
                </div>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Navigation Buttons -->
      <button
        type="button"
        id="gallery-prev"
        class="cursor-pointer absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 md:-translate-x-4 bg-(--color-button-primary) text-(--color-text-primary) rounded-full p-3 shadow-lg z-10 transition-all duration-300 hover:scale-110 hover:bg-(--color-primary) disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100"
        aria-label="Previous images"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <button
        type="button"
        id="gallery-next"
        class="cursor-pointer absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 md:translate-x-4 bg-(--color-button-primary) text-(--color-text-primary) rounded-full p-3 shadow-lg z-10 transition-all duration-300 hover:scale-110 hover:bg-(--color-primary) disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100"
        aria-label="Next images"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</section>

<script>
  // Staggered fade-in animation
  const observerOptions = {
    root: null,
    rootMargin: "0px 0px -50px 0px",
    threshold: 0.1,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const el = entry.target as HTMLElement;
        const delay = el.style.getPropertyValue("--delay") || "0ms";

        setTimeout(() => {
          el.classList.add("animate-in");
        }, parseInt(delay));

        observer.unobserve(el);
      }
    });
  }, observerOptions);

  document.querySelectorAll(".gallery-item").forEach((item) => {
    observer.observe(item);
  });

  // Navigation buttons
  const container = document.getElementById("gallery-scroll");
  const prevBtn = document.getElementById("gallery-prev") as HTMLButtonElement;
  const nextBtn = document.getElementById("gallery-next") as HTMLButtonElement;

  if (container && prevBtn && nextBtn) {
    const updateButtons = () => {
      const { scrollLeft, scrollWidth, clientWidth } = container;
      prevBtn.disabled = scrollLeft <= 0;
      nextBtn.disabled = scrollLeft >= scrollWidth - clientWidth - 10;
    };

    const scrollBy = (direction: number) => {
      const scrollAmount = container.clientWidth * 0.8;
      container.scrollBy({ left: direction * scrollAmount, behavior: "smooth" });
    };

    prevBtn.addEventListener("click", () => scrollBy(-1));
    nextBtn.addEventListener("click", () => scrollBy(1));
    container.addEventListener("scroll", updateButtons);

    updateButtons();
  }
</script>

<style>
  .gallery-item {
    transition:
      opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .gallery-item.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
</style>
